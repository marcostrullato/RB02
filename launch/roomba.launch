<?xml version="1.0"?>
<launch>
	<!-- freenect include START -->
	<include file="$(find freenect_launch)/launch/freenect.launch">
		<arg name="depth_registration" value="True" />
	</include>
	<!-- freenect include END -->
	<!-- create arguments START -->
	<arg name="config" default="$(find create_bringup)/config/default.yaml" />
	<!-- create arguments END -->
	<!-- raspicam arguments START -->
	<!--
	<arg name="enable_raw" default="false"/>
	<arg name="enable_imv" default="false"/>
	<arg name="camera_id" default="0"/>
	<arg name="camera_frame_id" default="raspicam"/>
	<arg name="camera_name" default="camerav2_410x308"/>
	-->
	<!-- raspicam arguments END -->
	<!-- freenect arguments START -->
	<arg name="desc" default="true" />
	<arg name="rate" default="5" />
	<arg name="data_skip" default="2" />
	<arg name="approx_sync" default="true" />
	<!-- true for freenect driver -->
	<arg name="rgbd_sync" default="false" />
	<!-- freenect arguments END -->
	<!-- create node START -->
	<node name="create_driver" pkg="create_driver" type="create_driver" output="screen">
		<rosparam command="load" file="$(arg config)" />
		<param name="robot_model" value="CREATE_2" />
	</node>
	<!-- Robot description -->
	<include if="$(arg desc)" file="$(find create_description)/launch/create_2.launch" />
	<!-- create node END -->
	<!--
	raspicam node START
	
	<node type="raspicam_node" pkg="raspicam_node" name="raspicam_node" output="screen">
	<param name="private_topics" value="true"/>
	
	<param name="camera_frame_id" value="$(arg camera_frame_id)"/>
	<param name="enable_raw" value="$(arg enable_raw)"/>
	<param name="enable_imv" value="$(arg enable_imv)"/>
	<param name="camera_id" value="$(arg camera_id)"/>
	
	<param name="camera_info_url" value="package://raspicam_node/camera_info/camerav2_410x308.yaml"/>
	<param name="camera_name" value="$(arg camera_name)"/>
	<param name="width" value="410"/>
	<param name="height" value="308"/>
	
	<param name="framerate" value="30"/>
	<param name="exposure_mode" value="antishake"/>
	<param name="shutter_speed" value="0"/>
	</node>
	raspicam node END
	-->
	<!-- freenect nodes START -->
	<!--
	<group ns="camera">
	<node if="$(arg rgbd_sync)" pkg="nodelet" type="nodelet" name="rgbd_sync" args="load rtabmap_ros/rgbd_sync camera_nodelet_manager" output="screen">
	<param name="compressed_rate" type="double" value="$(arg rate)" />
	<param name="approx_sync" type="bool" value="$(arg approx_sync)" />
	<remap from="rgb/image" to="rgb/image_rect_color" />
	<remap from="depth/image" to="depth_registered/image_raw" />
	<remap from="rgb/camera_info" to="rgb/camera_info" />
	<remap from="rgbd_image" to="rgbd_image" />
	</node>
	<node unless="$(arg rgbd_sync)" pkg="nodelet" type="nodelet" name="data_throttle" args="load rtabmap_ros/data_throttle camera_nodelet_manager" output="screen">
	<param name="rate" type="double" value="$(arg rate)" />
	<param name="approx_sync" type="bool" value="$(arg approx_sync)" />
	<remap from="rgb/image_in" to="rgb/image_rect_color" />
	<remap from="depth/image_in" to="depth_registered/image_raw" />
	<remap from="rgb/camera_info_in" to="rgb/camera_info" />
	<remap from="rgb/image_out" to="throttled/rgb/image_rect_color" />
	<remap from="depth/image_out" to="throttled/depth_registered/image_raw" />
	<remap from="rgb/camera_info_out" to="throttled/rgb/camera_info" />
	</node>
	</group>
	-->
	<group ns="rtabmap">
		<node pkg="nodelet" type="nodelet" name="rgbd_sync" args="standalone rtabmap_ros/rgbd_sync" output="screen">
			<remap from="rgb/image" to="/camera/rgb/image_rect_color" />
			<remap from="depth/image" to="/camera/depth_registered/image_raw" />
			<remap from="rgb/camera_info" to="/camera/rgb/camera_info" />
			<remap from="rgbd_image" to="rgbd_image" />
			<!-- output -->
			<!--
			Should be true for not synchronized camera topics
			(e.g., false for kinectv2, zed, realsense, true for xtion, kinect360)
			-->
			<param name="approx_sync" value="true" />
		</node>
		<node name="rtabmap" pkg="rtabmap_ros" type="rtabmap" output="screen" args="--delete_db_on_start">
			<param name="frame_id" type="string" value="base_link" />
			<param name="subscribe_depth" type="bool" value="false" />
			<param name="subscribe_rgbd" type="bool" value="true" />
			<remap from="odom" to="/base_controller/odom" />
			<remap from="rgbd_image" to="rgbd_image" />
			<param name="queue_size" type="int" value="10" />
			<!-- RTAB-Map's parameters -->
			<param name="RGBD/AngularUpdate" type="string" value="0.01" />
			<param name="RGBD/LinearUpdate" type="string" value="0.01" />
			<param name="RGBD/OptimizeFromGraphEnd" type="string" value="false" />
		</node>
	</group>
	<!-- freenect nodes END -->
</launch>
